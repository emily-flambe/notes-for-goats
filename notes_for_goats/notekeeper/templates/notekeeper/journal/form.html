{% extends "notekeeper/base.html" %}

{% block title %}
    {% if entry %}Edit{% else %}New{% endif %} Journal Entry - {{ workspace.name }}
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>{% if entry and entry.id %}Edit{% else %}Create{% endif %} Journal Entry</h1>
    </div>
    
    <div class="card">
        <form method="post">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.title.id_for_label }}">Title</label>
                {{ form.title }}
                {% if form.title.errors %}
                    <div class="error">{{ form.title.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.timestamp.id_for_label }}">Date/Time</label>
                <div class="datepicker-wrapper">
                    {{ form.timestamp }}
                </div>
                {% if form.timestamp.errors %}
                    <div class="error">{{ form.timestamp.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.content.id_for_label }}">Content</label>
                {{ form.content }}
                {% if form.content.errors %}
                    <div class="error">{{ form.content.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.entities.id_for_label }}">Related Entities</label>
                {{ form.entities }}
                <div class="form-text">Select entities related to this journal entry</div>
                {% if form.entities.errors %}
                    <div class="error">{{ form.entities.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save</button>
                
                {% comment %}Use a more robust way to handle the Cancel button URL{% endcomment %}
                {% if request.GET.next %}
                    <a href="{{ request.GET.next }}" class="btn">Cancel</a>
                {% elif workspace_id %}
                    <a href="{% url 'notekeeper:journal_list' workspace_id=workspace_id %}" class="btn">Cancel</a>
                {% elif entry.workspace.id %}
                    <a href="{% url 'notekeeper:journal_list' workspace_id=entry.workspace.id %}" class="btn">Cancel</a>
                {% else %}
                    <a href="javascript:history.back()" class="btn">Cancel</a>
                {% endif %}
            </div>
        </form>
    </div>
</div>
{% endblock %} 